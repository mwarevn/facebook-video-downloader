<div class="main-content " style="min-height: calc(100vh - 528px);">

	<section style="background-color: #4f37ac;">
		<h1 class="font-bold text-5xl text-center text-white">Tải Video Facebook <small class="text-warning">riêng tư</small></h1>
		<span class="block text-center mt-1 text-lg text-white">Tải video <small class="text-warning">riêng tư</small> từ Facebook 1080 - 2K - 4K. Miễn Phí</span>
		<svg id="wave" viewBox="0 0 100 15">
			<path fill="#fff" opacity="0.5" d="M0 30 V15 Q30 3 60 15 V30z"></path>
			<path fill="#fff" d="M0 30 V12 Q30 17 55 12 T100 11 V30z"></path>
		</svg>
	</section>




	<section class=" mt-8 mx-4 ">

		<div class="mx-auto xl:w-4/6 lg:w-2/3 md:w-2/3 sm:w-96">
			<div>
				<div class="label">
					<span class="label-text pb-0">Bước 1: Dán URL video facebook.</span>
				</div>
				<input id="input-video-url" onchange="convert_url_to_view_source()" class="input input-bordered rounded rounded-0 w-full" placeholder="Dán URL video Facebook..." />
			</div>
		</div>

		<div class="mx-auto mt-2 xl:w-4/6 lg:w-2/3 md:w-2/3 sm:w-96">
			<div>
				<div class="label">
					<span class="label-text pb-0">Bước 2: Đi tới url này và copy toàn bộ nội dung bên trong trang.</span>
				</div>
				<div class="join  w-full">
					<a class="btn join-item go-view-source" target="_blank">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
							<path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
						</svg>
					</a>
					<input disabled id="input-url-page-source" class="input input-bordered join-item rounded rounded-0 w-full" placeholder="Đi tới url này và copy toàn bộ nội dung bên trong trang." />
				</div>
			</div>
		</div>

		<div class="mx-auto mt-2 xl:w-4/6 lg:w-2/3 md:w-2/3 sm:w-96">
			<div>
				<div class="label">
					<span class="label-text pb-0">Bước 3: Dán toàn bộ nội dung vừa copy được vào bên dưới rồi bấm download để tải.</span>
				</div>
				<textarea id="input-page-source" class="textarea textarea-bordered rounded rounded-0 h-48 w-full" placeholder="Dán toàn bộ nội dung vào đây...."></textarea>
			</div>
		</div>


		<div class="indicator tooltip mx-auto mt-4 block" data-tip="Click to get link download">
			<button class="btn btn-primary join-item" id="btn-download">Download</button>
		</div>
	</section>



	<section class="display-result mt-8  flex justify-center mx-4" id="pattern-result">
		<div role="alert" class="alert alert-warning mx-auto p-3 py-2 rounded rounded-2 xl:w-1/2 lg:w-2/3 md:w-2/3 sm:w-96" style="display: none;">
			<svg xmlns="http://www.w3.org/2000/svg" fill="#FFF" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
				<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m0-10.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.25-8.25-3.286Zm0 13.036h.008v.008H12v-.008Z" />
			</svg>
			<span class="alert-msg text-dark"></span>
		</div>


		<span class="loading loading-ring loading-lg block mx-auto" style="display: none;"></span>

		<div class="overflow-x-auto mx-auto xl:w-1/2 lg:w-2/3 md:w-2/3 sm:w-96" id="table" style="display: none;">
			<table class="table">
				<!-- head -->
				<thead>
					<tr>
						<th>Chất lượng</th>
						<th>Download</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
		</div>
	</section>
</div>

<%- include('../partials/introduce/facebook_video_downloader.ejs') -%>

<script>
	const $ = document.querySelector.bind(document);


	const goViewSource = $('.go-view-source')
	const btn_download = $("#btn-download");
	const input_video_url = $("#input-video-url")
	const loading = $('.loading')
	const table = $('#table')
	const tbody = $('tbody')
	const btnPaste = $('#btn-paste')
	const input_url_page_source = $('#input-url-page-source')

	const alert = $('.alert');
	const alert_msg = $('.alert-msg');

	const input_page_source = $('#input-page-source')

	const convert_url_to_view_source = () => {
		input_url_page_source.value = "view-source:" + input_video_url.value
	}

	const showAlert = (msg = '', type = "WARNING") => {
		alert_msg.innerHTML = msg;
		alert.style.display = 'flex'
	}

	const hideAlert = () => {
		alert.style.display = 'none'
		alert_msg.innerText = '';
	}

	btn_download.onclick = () => {

		hideAlert()

		if (input_page_source.value == "" || !input_video_url) {
			showAlert('Vui lòng dán nội dung copy.')
			return;
		}

		loading.style.display = "block"
		tbody.innerHTML = ''
		table.style.display = 'none'

		let page_source = input_page_source.value.split('is_rss_podcast_video')[1].split('spherical_video_fallback_urls')[0]
		fetch("/get-private-video", {
				method: "POST",
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					page_source
				})
			})
			.then(res => res.json())
			.then(res => {
				let childs = false;

				for (let key in res) {
					let type_quality = null;

					switch (key) {
						case "sd_url":
							type_quality = "360 (SD)"
							break;

						case "hd_url":
							type_quality = "720 (HD)"
							break;
					}

					if (res[key]) {
						childs = true;
						let html = `
								<th>${type_quality}</th>
								<td><a rel="nofollow" href="${res[key]}" class="link link-success link-hover" download>Download</a></td>
						`;


						// download="${res[key]}"
						let tr = document.createElement('tr');
						tr.innerHTML = html;

						tbody.appendChild(tr)
					}
				}

				if (childs) {
					table.style.display = "block"

				} else {
					showAlert("Lỗi không thể lấy video.")
				}

				input_page_source.scrollIntoView()

			})
			.finally(() => {
				loading.style.display = "none"
			})

	}
</script>